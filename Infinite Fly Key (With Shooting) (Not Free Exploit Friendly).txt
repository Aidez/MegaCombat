local FlyKey = "f" -- Type a letter in the quotes to change the key that'll toggle noclip



------------------------------------

repeat wait() until game.Players ~= nil
repeat wait() until game.Players.LocalPlayer ~= nil

local LocalP = game.Players.LocalPlayer
local mouse = LocalP:GetMouse()

local flying = false
local flyspeed = 2
local firstfly = true
local JumpingStateDebounce = false
local Seats = {}

local fakemodel = Instance.new("Model")
fakemodel.Parent = game.Workspace
local fakehumanoid = Instance.new("Humanoid")

local meta = getrawmetatable(game)
local namecall = meta.__namecall
local newindex = meta.__newindex
if PROTOSMASHER_LOADED then
    make_writeable(meta, true)
else
    setreadonly(meta, false)
end

meta.__namecall=newcclosure(function(self,...)
    if not checkcaller() or not is_protosmasher_caller() then
        local method = ""
        if PROTOSMASHER_LOADED then
            method = get_namecall_method()
        else
            method = getnamecallmethod()
        end
        if method == "Destroy" then
            if tostring(self) == "BodyGyro" or tostring(self) == "BodyVelocity" then
                local destroybait = Instance.new("Part", game.Workspace)
                return namecall(destroybait,...)
            end
        end
        if method == "BreakJoints" and tostring(self) == LocalP.Character.Name then
            return namecall(fakemodel,...)
        end
        if method == "ClearAllChildren" or method == "Destroy" then 
            return
        end
    end
    return namecall(self,...)
end)

meta.__newindex=newcclosure(function(self,k,new)
    if not checkcaller() or not is_protosmasher_caller() then
        if tostring(self) == "Humanoid" and tostring(k) == "Health" then
            return newindex(fakehumanoid,k,new)
        end
    end
    return newindex(self,k,new)
end)

local function togglefly()
    flying = not flying
    local currenttext = ""
    if flying == true then
        currenttext = "FLIGHT is now turned ON!"
        for i,v in pairs(Seats) do
            if v.Parent ~= nil then
                v.Parent = game.ReplicatedStorage
            end
        end
    else
        currenttext = "FLIGHT is now turned OFF!"
        for i,v in pairs(Seats) do
            if v.Parent ~= nil then
                v.Parent = game.Workspace
            end
        end
    end
    game.StarterGui:SetCore("SendNotification", {
        Title = "notification";
        Text = currenttext;
        Icon = "rbxassetid://2541869220";
        Duration = 1.3;
    })
    if flying then -- BIG CREDIT TO IY AND ROCKY'S ADMIN
        if LocalP.Character ~= nil then
            if LocalP.Character:FindFirstChild("HumanoidRootPart") and LocalP.Character:FindFirstChild("Humanoid") then
                local Float = Instance.new('Part', LocalP.Character)
                Float.Name = "Float"
                Float.Transparency = 1
                Float.Size = Vector3.new(6,1,6)
                Float.Anchored = true
                LocalP.Character.HumanoidRootPart.Anchored = true
                local T = LocalP.Character.HumanoidRootPart
                local CONTROL = {F = 0, B = 0, L = 0, R = 0}
                local lCONTROL = {F = 0, B = 0, L = 0, R = 0}
                local SPEED = 0
                local function FLY()
                    FLYING = true
                    local BG = Instance.new('BodyGyro', T)
                    local BV = Instance.new('BodyVelocity', T)
	            BG.P = 9e4
                    BG.maxTorque = Vector3.new(9e9, 9e9, 9e9)
                    BG.cframe = T.CFrame
                    BV.velocity = Vector3.new(0, 0.1, 0)
                    BV.maxForce = Vector3.new(9e9, 9e9, 9e9)
                    spawn(function()
                        repeat wait()
                        if CONTROL.L + CONTROL.R ~= 0 or CONTROL.F + CONTROL.B ~= 0 then
                            SPEED = 50
                        elseif not (CONTROL.L + CONTROL.R ~= 0 or CONTROL.F + CONTROL.B ~= 0) and SPEED ~= 0 then
                            SPEED = 0
                        end
                        if (CONTROL.L + CONTROL.R) ~= 0 or (CONTROL.F + CONTROL.B) ~= 0 then
                            BV.velocity = ((workspace.CurrentCamera.CoordinateFrame.lookVector * (CONTROL.F + CONTROL.B)) + ((workspace.CurrentCamera.CoordinateFrame * CFrame.new(CONTROL.L + CONTROL.R, (CONTROL.F + CONTROL.B) * 0.2, 0).p) - workspace.CurrentCamera.CoordinateFrame.p)) * SPEED
                            lCONTROL = {F = CONTROL.F, B = CONTROL.B, L = CONTROL.L, R = CONTROL.R}
                        elseif (CONTROL.L + CONTROL.R) == 0 and (CONTROL.F + CONTROL.B) == 0 and SPEED ~= 0 then
                            BV.velocity = ((workspace.CurrentCamera.CoordinateFrame.lookVector * (lCONTROL.F + lCONTROL.B)) + ((workspace.CurrentCamera.CoordinateFrame * CFrame.new(lCONTROL.L + lCONTROL.R, (lCONTROL.F + lCONTROL.B) * 0.2, 0).p) - workspace.CurrentCamera.CoordinateFrame.p)) * SPEED
                        else
                            BV.velocity = Vector3.new(0, 0.1, 0)
                        end
                        BG.cframe = workspace.CurrentCamera.CoordinateFrame
                        until not FLYING
                        CONTROL = {F = 0, B = 0, L = 0, R = 0}
                        lCONTROL = {F = 0, B = 0, L = 0, R = 0}
                        SPEED = 0
                        BG:destroy()
                        BV:destroy()
                    end)
                end
                mouse.KeyDown:connect(function(KEY)
                    if KEY:lower() == 'w' then
                        CONTROL.F = flyspeed
                    elseif KEY:lower() == 's' then
                        CONTROL.B = -flyspeed
                    elseif KEY:lower() == 'a' then
                        CONTROL.L = -flyspeed 
                    elseif KEY:lower() == 'd' then 
                        CONTROL.R = flyspeed
                    end
                end)
                mouse.KeyUp:connect(function(KEY)
                    if KEY:lower() == 'w' then
                        CONTROL.F = 0
                    elseif KEY:lower() == 's' then
                        CONTROL.B = 0
                    elseif KEY:lower() == 'a' then
                        CONTROL.L = 0
                    elseif KEY:lower() == 'd' then
                        CONTROL.R = 0
                    end
                end)
                FLY()
                LocalP.Character.HumanoidRootPart.Anchored = false
            elseif LocalP.Character:FindFirstChild("Torso") and LocalP.Character:FindFirstChild("Humanoid") then
                local Float = Instance.new('Part', LocalP.Character)
                Float.Name = "Float"
                Float.Transparency = 1
                Float.Size = Vector3.new(6,1,6)
                Float.Anchored = true
                LocalP.Character.Torso.Anchored = true
                local T = LocalP.Character.Torso
                local CONTROL = {F = 0, B = 0, L = 0, R = 0}
                local lCONTROL = {F = 0, B = 0, L = 0, R = 0}
                local SPEED = 0
                local function FLY()
                    FLYING = true
                    local BG = Instance.new('BodyGyro', T)
                    local BV = Instance.new('BodyVelocity', T)
	            BG.P = 9e4
                    BG.maxTorque = Vector3.new(9e9, 9e9, 9e9)
                    BG.cframe = T.CFrame
                    BV.velocity = Vector3.new(0, 0.1, 0)
                    BV.maxForce = Vector3.new(9e9, 9e9, 9e9)
                    spawn(function()
                        repeat wait()
                        if CONTROL.L + CONTROL.R ~= 0 or CONTROL.F + CONTROL.B ~= 0 then
                            SPEED = 50
                        elseif not (CONTROL.L + CONTROL.R ~= 0 or CONTROL.F + CONTROL.B ~= 0) and SPEED ~= 0 then
                            SPEED = 0
                        end
                        if (CONTROL.L + CONTROL.R) ~= 0 or (CONTROL.F + CONTROL.B) ~= 0 then
                            BV.velocity = ((workspace.CurrentCamera.CoordinateFrame.lookVector * (CONTROL.F + CONTROL.B)) + ((workspace.CurrentCamera.CoordinateFrame * CFrame.new(CONTROL.L + CONTROL.R, (CONTROL.F + CONTROL.B) * 0.2, 0).p) - workspace.CurrentCamera.CoordinateFrame.p)) * SPEED
                            lCONTROL = {F = CONTROL.F, B = CONTROL.B, L = CONTROL.L, R = CONTROL.R}
                        elseif (CONTROL.L + CONTROL.R) == 0 and (CONTROL.F + CONTROL.B) == 0 and SPEED ~= 0 then
                            BV.velocity = ((workspace.CurrentCamera.CoordinateFrame.lookVector * (lCONTROL.F + lCONTROL.B)) + ((workspace.CurrentCamera.CoordinateFrame * CFrame.new(lCONTROL.L + lCONTROL.R, (lCONTROL.F + lCONTROL.B) * 0.2, 0).p) - workspace.CurrentCamera.CoordinateFrame.p)) * SPEED
                        else
                            BV.velocity = Vector3.new(0, 0.1, 0)
                        end
                        BG.cframe = workspace.CurrentCamera.CoordinateFrame
                        until not FLYING
                        CONTROL = {F = 0, B = 0, L = 0, R = 0}
                        lCONTROL = {F = 0, B = 0, L = 0, R = 0}
                        SPEED = 0
                        BG:destroy()
                        BV:destroy()
                    end)
                end
                mouse.KeyDown:connect(function(KEY)
                    if KEY:lower() == 'w' then
                        CONTROL.F = flyspeed
                    elseif KEY:lower() == 's' then
                        CONTROL.B = -flyspeed
                    elseif KEY:lower() == 'a' then
                        CONTROL.L = -flyspeed 
                    elseif KEY:lower() == 'd' then 
                        CONTROL.R = flyspeed
                    end
                end)
                mouse.KeyUp:connect(function(KEY)
                    if KEY:lower() == 'w' then
                        CONTROL.F = 0
                    elseif KEY:lower() == 's' then
                        CONTROL.B = 0
                    elseif KEY:lower() == 'a' then
                        CONTROL.L = 0
                    elseif KEY:lower() == 'd' then
                        CONTROL.R = 0
                    end
                end)
                FLY()
                LocalP.Character.Torso.Anchored = false
            end
        end
    else
        if LocalP.Character then
            if LocalP.Character:FindFirstChild("Float") then
                LocalP.Character:FindFirstChild("Float"):Destroy()
            end
        end
        local AnimationTracks = LocalP.Character.Humanoid:GetPlayingAnimationTracks()
        for i, track in pairs (AnimationTracks) do
            if track.Name ~= "WalkAnim" then
                track:Stop()
            end
        end
        FLYING = false
    end
end

mouse.KeyDown:Connect(function(key)
    if key == FlyKey then
        if firstfly then
            game.StarterGui:SetCore("SendNotification", {
                Title = "CHANGING FLY SPEED";
                Text = "Use the :flyspeed NUMBER command to set your fly speed!";
                Icon = "rbxassetid://2541869220";
                Duration = 3;
            })
            firstfly = false
        end
        togglefly()
    end
end)

game:GetService('RunService').Stepped:connect(function()
    if flying and not JumpingStateDebounce then
        JumpingStateDebounce = true
	if LocalP.Character then
	    if LocalP.Character:FindFirstChild("Humanoid") then
                wait()
                LocalP.Character.Humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
	   end
	end
        JumpingStateDebounce = false
    end
end)

game:GetService('RunService').Stepped:connect(function()
    if flying then
	if LocalP.Character then
            if LocalP.Character:FindFirstChild("Humanoid") then
		LocalP.Character.Humanoid.PlatformStand = false
		LocalP.Character.Humanoid.Sit = false
                LocalP.Character.Humanoid:ChangeState(Enum.HumanoidStateType.Running)
            end
            if LocalP.Character:FindFirstChild("Float") then
                LocalP.Character:FindFirstChild("Float").CFrame = LocalP.Character.HumanoidRootPart.CFrame * CFrame.new(0,-3.5,0)
            end
        end
    end
end)

repeat wait() until LocalP.Character ~= nil
repeat wait() until LocalP.Character:FindFirstChild("Humanoid")

LocalP.Character.Humanoid.Died:Connect(function()
    if flying then
        togglefly()
    end
end)

LocalP.CharacterAdded:Connect(function(char)
    repeat wait() until LocalP.Character:FindFirstChild("Humanoid")
    LocalP.Character.Humanoid.Died:Connect(function()
        if flying then
            togglefly()
        end
    end)
end)

for i,v in pairs(game.Workspace:GetDescendants()) do
    if v:IsA("Seat") then
        table.insert(Seats, v)
    end
end

print("")
print(string.upper(NoclipKey).." Key - Toggle Fly")
print("")

--[[
                                                        ..                                          
                                     /yys.            `hMM/                                        
                    :ys:            `NMMMo            oMMM:                                        
                  `sMMMm             -oo:            `NMMy                                          
                 .hMMMMM+                            +MMN`        `.-::.              `            
                -mMMyoMMN.         /hho       .:syhhomMMs       -smNMMMNy  `shysssssyhdho          
               :mMMs``dMMd`        NMMm     .smMNdhdMMMM.     `sNMNs:/MMM. `ydmmmmddMMMN+          
              +NMMs   -MMMs       :MMM/    +NMNs-  .MMMy     .dMMd- -yMMy    `````/hMMy-            
            `yMMMmosyhdMMMM+      yMMm    yMMN:   `yMMM/     dMMN+odNMd/        :hMNy:              
           -dMMMMMMmmdhyhMMM+     NMMo   /MMM-   :dMMMM-    :MMMMNmho-``:/    :hNMh-                
          +NMMm//-..``  `hMMMo`  -MMM/   yMMm``:hNMyMMM+.-- :MMMy.` `-omMd` /dMMmo/+oooo/`          
         oMMMh.          `yMMMm/ :MMMs   +MMMmmMNh: hMMNNNy  yMMMmhdmNMm+`:dMMMMNNNNmNMMMo          
         :yh+`            `/dNNs `ydh:    :shys/.   `+yso-`   :shddhy+-` oNMNho:-..```.-/`  
 
Join my discord here!:
https://discord.gg/Ez2dGeQ
 
This script includes mega combat's fly toggle + bypass
Change the toggle key at the top of the script.

--]]